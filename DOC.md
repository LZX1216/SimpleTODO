# TODO List 项目说明文档

## 1. 技术选型
- **编程语言**：Python 3.12 ，理由：高效率、代码简洁，非常适合在短时间内实现高质量的 RESTful API。
- **框架/库**：FastAPI，理由：高性能异步框架，主动生成文档。  
- **数据库/存储**：MySQL (通过 Docker)，理由：稳定、成熟、支持复杂查询和事务。 
- **前端**：Vue 3 (Vite + 基础 JS/CSS)，理由：轻量级、易上手，适合快速开发简单界面。
- **部署方式**：Docker，理由：环境一致性，易于部署和扩展。
- 替代方案对比：
  - Java (Spring Boot)：复杂度高，开发周期长，不适合本项目一周内交付的需求。  
  - SQLite：不适合前后端分离和未来的扩展需求。
  - 纯 HTML/JS：缺乏结构化和可维护性，不适合复杂交互。
  - 直接部署在本地环境：缺乏可移植性和一致性，Docker 提供了更好的解决方案。

## 2. 项目结构设计
- 整体架构说明（前端/后端/数据库关系，或命令行工具的模块划分）。  
  - 采取前后端分离架构，前端负责用户交互和界面展示，后端进行数据处理和存储。前后端通过 Axios 进行通信。数据库用于持久化存储任务数据。
- 目录结构示例：  
  ```
    SimpleTODO/
    ├── backend/                   # Python FastAPI 后端服务
    │   ├── app/                   # 核心应用代码
    │   │   ├── api/               # 路由和端点定义
    │   │   │   └── tasks.py      # 任务相关的 API 路由
    │   │   ├── core/              # 配置和数据库连接
    │   │   │   ├── config.py      # 应用配置
    │   │   │   └── database.py    # 数据库连接
    │   │   ├── crud/              # 数据库操作逻辑
    │   │   │   └── task.py       # 任务的 CRUD 操作
    │   │   ├── models/            # SQLAlchemy ORM 模型
    │   │   │   └── task.py        # 任务数据模型
    │   │   ├── schemas/           # Pydantic 数据验证模型
    │   │   │   └── task.py        # 任务的请求/响应模型
    │   │   └── main.py            # FastAPI 应用入口
    │   ├── venv/                  # Python 虚拟环境
    │   ├── Dockerfile             # 后端 Docker 镜像配置
    │   └── requirements.txt       # Python 依赖
    ├── frontend/                  # Vue 3 前端应用
    │   ├── src/
    │   │   ├── App.vue            # 主应用组件（包含所有功能）
    │   │   ├── assets/            # 静态资源（CSS、图片等）
    │   │   ├── components/        # UI 组件（示例组件）
    │   │   └── main.js            # 应用入口
    │   ├── package.json           # 前端依赖
    │   └── vite.config.js         # Vite 配置
    ├── docker-compose.yml         # 定义后端和数据库服务
    ├── DOC.md                     # 项目说明文档
    └── README.md                  # 快速开始指南
  ```  
- 模块职责说明。  
  - **backend/app/main.py**: FastAPI 应用入口，初始化应用、配置 CORS、注册路由。
  - **backend/app/core/config.py**: 应用配置管理（数据库连接、CORS 设置等）。
  - **backend/app/core/database.py**: 数据库连接和会话管理，使用 SQLAlchemy ORM。
  - **backend/app/models/task.py**: SQLAlchemy 数据模型定义，对应数据库表结构。
  - **backend/app/schemas/task.py**: Pydantic 数据验证模型，用于请求验证和响应序列化。
  - **backend/app/crud/task.py**: 数据库 CRUD 操作逻辑，封装数据库查询和更新操作。
  - **backend/app/api/tasks.py**: RESTful API 路由定义，处理 HTTP 请求和响应，包括导入/导出功能。
  - **frontend/src/App.vue**: Vue 3 主应用组件，包含所有业务逻辑和 UI 渲染，包括导入/导出功能。
  - **frontend/src/assets/**: 全局样式和静态资源。

## 3. 需求细节与决策
- 描述是否必填？如何处理空输入？ 
  - 标题必填，描述可选。空输入时，标题为空则不允许添加，并给出提示；描述为空则存入 `null`。
  - 前端限制：标题最大 255 字符，描述最大 1000 字符，分类最大 50 字符。
- 已完成的任务在 UI 中如何显示？  
  - 已完成任务有独立的折叠区域，默认折叠。可通过按钮展开/折叠查看已完成任务。已完成任务默认不占用主列表的空间，应该聚焦于待办的事项。
- 任务优先级如何体现？（颜色区分 / 图标 / 排序）
  - 前端通过图标和颜色区分：🔥 高优先级（红色）、⚡ 中优先级（橙色）、💧 低优先级（绿色）。数据库中添加 `priority` 字段，123 分别对应高中低。手动排序反而增加使用负担。
  - 支持按优先级排序，高优先级任务显示在前面。
- 任务排序逻辑（默认按创建时间，用户可选按优先级）。  
  - 默认排序：按创建时间降序 (最新创建的在最上面)。
  - 用户可选排序：
    - 按优先级：高 -> 中 -> 低，相同优先级按创建时间降序。
    - 按截止日期：即将到期的在前，无截止日期的在最后，相同日期按优先级排序。
- 任务分类功能
  - 由后端数据库的 `category` 存储。
  - 默认分类：工作、学习、生活、其他。
  - 支持自定义分类：用户可以在输入框中输入新分类名称。
  - 分类列表自动从数据库中实际存在的任务分类中提取，合并默认分类后显示。
  - 支持按分类筛选任务。
- 任务截止日期功能
  - 支持设置任务的截止日期（可选）。
  - 过期任务会显示红色警告样式，并有脉冲动画提醒。
  - 今天的任务会显示橙色高亮样式，便于快速识别。
  - 日期显示格式：
    - 今天：`今天（11月15日）`
    - 明天：`明天（11月16日）`
    - 已过期：`已过期5天（11月10日）`（显示过期天数）
    - 未来日期：`5天后（11月20日）`（显示剩余天数）
    - 如果日期不在今年，会自动加上年份
- 日期筛选功能
  - 支持按日期范围筛选任务，包括：
    - 全部（默认）
    - 已过期：显示所有已过期的任务
    - 今天到期：显示今天到期的任务
    - 明天到期：显示明天到期的任务
    - 本周到期：显示未来7天内到期的任务
    - 本月到期：显示未来30天内到期的任务
    - 无截止日期：显示没有设置截止日期的任务
  - 日期筛选与分类筛选、搜索功能可以同时使用。
- 懒加载功能
  - 全量加载大量任务可能造成性能问题。
  - 使用 Intersection Observer API 实现滚动懒加载。
  - 初始显示 10 条任务，滚动到底部时自动加载更多。
  - 待处理任务和已完成任务分别进行懒加载。
  - 编辑任务后不会重置显示数量，保持当前浏览位置。
  - 只有在筛选条件变化时才会重置为初始10条。
- 数据导入/导出功能
  - **导出功能**：支持导出所有任务数据为 JSON 格式，包含完整的任务信息和导出时间戳。导出文件自动命名，包含当前日期（格式：`tasks_export_YYYY-MM-DD.json`）。
  - **导入功能**：支持从 JSON 文件批量导入任务数据。导入时会验证文件格式和数据有效性，支持导入任务的完成状态（is_completed）。导入的任务会添加到现有任务中，不会覆盖现有数据。
  - **导入/导出按钮**：位于页面头部，方便快速访问。导入按钮会触发文件选择对话框，只接受 JSON 格式文件。
- 全文搜索功能
  - 支持在任务标题、描述、分类中搜索关键词。
  - 使用模糊匹配（LIKE 查询），支持部分关键词匹配。
  - 前端实现防抖处理（300ms），减少不必要的 API 请求，提升性能。
  - 搜索框位于筛选和排序控件上方，方便快速访问。
  - 支持按 Enter 键立即搜索，或点击清除按钮快速清空搜索条件。
  - 搜索功能与分类筛选、排序功能可以同时使用，互不干扰。
- 任务描述展开/收起功能
  - 长描述内容默认折叠显示3行，超出部分隐藏。
  - 如果描述超过100个字符或包含换行符，会显示"展开/收起"按钮。
  - 点击按钮可以展开查看完整描述内容。
  - 描述内容支持换行显示，保留原始格式。
- 任务列表展开/收起功能
  - 待处理任务列表默认展开，可以通过点击标题收起/展开。
  - 已完成任务列表默认收起，可以通过点击标题展开/收起。
  - 两个列表的展开/收起状态相互独立。
- 快速回到顶部功能
  - 页面右下角提供浮动按钮，滚动超过300px时自动显示。
  - 点击按钮可以平滑滚动回到页面顶部。
  - 按钮带有淡入淡出动画效果。
- 响应式布局优化
  - 宽屏幕（≥992px）：左右分栏布局，左侧固定宽度350px，右侧自适应。
  - 窄屏幕（≤991px）：
    - 单栏布局，所有内容垂直排列
    - "添加任务"、"搜索筛选"、"任务统计"三个部分默认折叠，通过按钮切换显示
    - 三个按钮互斥，同时只能打开一个
    - 导入导出按钮横向排列，平分宽度
  - 超小屏幕（≤480px）：进一步优化按钮大小和间距

## 4. AI 使用说明
- 使用 AI 工具（Gemini + Copilot + Cursor）  
- 使用 AI 的环节：
  - 使用 Gemini 讨论、分析、辅助技术选型
  - 使用 Gemini 和 Cursor 辅助编写 README.md, DOC.md
  - 使用 Gemini、Copilot、Cursor 生成代码片段，定位与修复bug
  - 使用 Cursor 向数据库生成测试数据
- AI 输出如何修改：  
  - AI 初始倾向于集成 Vue Router 和 Pinia。我否决了这些建议，因为这是一个单页应用，引入复杂的状态管理和路由会增加不必要的复杂性和学习成本。
  - AI 默认生成的 docker-compose.yml 导致 MySQL 和 FastAPI 启动时发生 Connection refused 错误。我通过手动分析日志，确定这是 Docker 的时序竞争问题，并手动在 docker-compose.yml 中添加了 healthcheck 和 depends_on: service_healthy 条件来强制依赖。
  - AI 倾向于将所有逻辑写在一起。我手动将代码重构为 api/crud/models 三层结构，确保后端职责分离。
  - 遇到 AI 输出的代码在数据处理和验证上存在潜在遗漏时，我会结合自己的业务理解手动补充校验逻辑，而不是直接照搬生成结果。
  - 在导出和导入功能中，AI 只给出基础的实现方式。我参考实际使用场景，补充了导出文件命名、格式校验、合并数据等细节，提升用户体验。
  - AI 生成的部分 API 示例接口返回字段不完全贴合前端需要，我能判断并根据具体需求手动调整后端接口返回的数据结构，从而提高前后端协作效率。
  
## 5. 运行与测试方式
- 本地运行方式（安装依赖、启动命令）。  
  - **前置要求**：
    - Docker Desktop（用于运行后端和数据库）
    - Node.js 16+ 和 npm（用于运行前端）
  
  - **启动步骤**：
    1. 启动后端和数据库（Docker）：
       ```bash
       docker-compose up
       ```
       首次启动需要构建镜像，之后只需启动容器即可。
       后端服务运行在 http://localhost:8000
       数据库运行在 localhost:3306
   
    2. 启动前端（开发模式）：
       ```bash
       cd frontend
       npm install  # 首次运行需要安装依赖
       npm run dev
       ```
       前端服务运行在 http://localhost:5173
  
  - **热重载配置**：
    - 后端：已配置 `--reload` 选项和代码目录挂载，修改后端代码后自动重载，无需重启 Docker。
    - 前端：Vite 默认支持热模块替换（HMR），修改前端代码后浏览器自动刷新，无需重启 npm。
  
  - **访问地址**：
    - 前端应用：http://localhost:5173
    - 后端 API：http://localhost:8000
    - API 文档（Swagger UI）：http://localhost:8000/docs
    - API 文档（ReDoc）：http://localhost:8000/redoc
  
  - **停止服务**：
    ```bash
    # 停止 Docker 服务
    docker-compose down
    
    # 停止前端（在运行前端的终端按 Ctrl+C）
    ```
  
  - **重新构建**：
    ```bash
    # 如果修改了 requirements.txt 或 Dockerfile
    docker-compose build
    docker-compose up
    
    # 如果修改了 package.json
    cd frontend
    npm install
    ```

- 已测试过的环境
  - Windows 11 (PowerShell)
  - Docker Desktop for Windows
  - Node.js v24+ / npm v11+
  - Python 3.12（在 Docker 容器中）
  - MySQL 8.0（在 Docker 容器中）

- 已知问题与不足
  - 前端和后端需要分别启动，没有统一的启动脚本。
  - 数据库数据存储在 Docker volume 中，删除容器后数据会保留，如需清空数据需要手动删除 volume。
  - 前端在特定分辨率下存在布局问题。
  - 没有实现用户认证和授权，所有数据都是公开的。
  - 没有实现提醒功能。  

## 6. 总结与反思
- 如果有更多时间，你会如何改进？
  - **用户认证与授权**：实现基于 JWT 或 OAuth2 的用户认证，支持多用户使用，每个用户只能看到自己的任务，提升数据安全性。
  - **实现提醒/通知功能**：引入 Redis (作为消息队列或存储临时的提醒任务) 和 Celery (作为 Python 异步任务执行器)，实现定时任务来检查截止日期并发送通知，以体现对分布式和异步任务处理的理解。
  - **前端组件化重构**：将 `App.vue` 拆分为多个可复用组件，提高代码可维护性和可测试性。
  - **单元测试与集成测试**：为后端 API 编写 pytest 测试，为前端组件编写 Vitest 测试，确保代码质量和功能稳定性。
  - **性能优化**：实现后端分页查询、Redis 缓存热点数据、前端虚拟滚动（处理大量任务时）、API 请求防抖等。
  - **数据备份与恢复**：实现定期自动备份功能。
  - **统一启动脚本**：创建一键启动脚本（如 `start.sh` 或 `start.bat`），同时启动前后端服务，简化开发流程。
  - **API 安全性增强**：添加请求限流、输入验证增强、SQL 注入防护、XSS 防护等安全措施。

- 你觉得这个实现的最大亮点是什么？
  - **清晰的分层架构**：后端采用 FastAPI 推荐的目录结构（api/crud/models/schemas/core），职责分离明确，代码组织规范，易于维护和扩展。这种架构使得添加新功能或修改现有功能都非常直观。
  - **完整的 Docker 化部署**：使用 Docker Compose 一键启动后端和数据库，配置了健康检查、数据持久化、代码热重载等，实现了开发和生产环境的一致性，大大降低了部署复杂度。
  - **优秀的开发体验**：配置了前后端热重载（后端 uvicorn --reload + 代码挂载，前端 Vite HMR），修改代码后自动生效，无需手动重启，极大提升了开发开发效率
  - **功能丰富且实用**：不仅实现了基础的 CRUD 操作，还添加了优先级管理、分类筛选、截止日期提醒、懒加载、多维度排序等实用功能，满足了实际使用场景的需求。
  - **现代化的技术栈**：使用 Python 3.12 + FastAPI（异步高性能）、Vue 3 Composition API（响应式编程）、MySQL 8.0（稳定可靠），技术选型合理且现代化。
  - **自动生成的 API 文档**：FastAPI 自动生成 Swagger UI 和 ReDoc 文档，API 接口清晰可见，方便前端开发和接口测试，体现了框架的优势。
  - **前端性能优化**：使用 Intersection Observer API 实现懒加载，初始只渲染少量任务，滚动时按需加载，提升了大量任务场景下的页面性能。
  - **良好的代码质量**：使用 Pydantic 进行数据验证、SQLAlchemy ORM 进行数据库操作、Vue 3 的响应式系统，代码类型安全、可读性强、易于调试。
  - **丰富的筛选和排序功能**：支持按分类、日期范围、关键词搜索等多维度筛选，支持按优先级、截止日期、创建时间排序，满足不同使用场景。
  - **完善的响应式设计**：针对不同屏幕尺寸优化布局，窄屏幕下提供折叠功能，确保在各种设备上都有良好的使用体验。
  - **智能的日期显示**：日期显示包含具体日期和相对时间（今天、明天、已过期X天、X天后），非今年的日期自动显示年份，信息清晰直观。